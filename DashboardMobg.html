<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRY SHOPPY - Pro Dashboard v6</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0d6efd;
  --bg:#f4f7fe;
  --white:#fff;
  --text:#1e293b;
  --border:#cbd5e1;
  --success:#22c55e;
}

body{
  font-family:'Cairo',sans-serif;
  background:var(--bg);
  margin:0;
  padding:20px;
  color:var(--text);
}

.container{max-width:1650px;margin:0 auto;}

header{
  text-align:center;
  margin-bottom:25px;
  border-bottom:2px solid var(--primary);
  padding-bottom:10px;
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
  margin-bottom:25px;
}

.stat-card{
  background:var(--white);
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
  border-right:5px solid var(--primary);
}

.stat-card h3{margin:0;font-size:.85rem;color:#64748b;}
.stat-card .value{font-size:1.5rem;font-weight:800;margin:5px 0;color:var(--primary);}

.filters{
  background:var(--white);
  padding:15px;
  border-radius:12px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:20px;
  align-items:center;
  box-shadow:0 2px 5px rgba(0,0,0,0.05);
}

.filters input,
.filters select{
  padding:10px;
  border:1px solid var(--border);
  border-radius:8px;
  flex:1;
  min-width:140px;
  font-family:'Cairo';
}

.btn-search{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:10px 25px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

.btn-group-action{
  background:#1a1a1a;
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

.btn-group-action.active{background:#dc2626;}

.btn-print-all{
  background:#5b21b6;
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

.table-wrapper{
  background:var(--white);
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 4px 15px rgba(0,0,0,0.08);
}

table{width:100%;border-collapse:collapse;text-align:right;}

th{
  background:#f1f5f9;
  padding:15px;
  border-bottom:2px solid var(--border);
  color:#475569;
  font-size:.85rem;
}

td{
  padding:15px;
  border-bottom:1px solid #f1f5f9;
  font-size:.95rem;
}

.price-input{
  width:90px;
  padding:6px;
  border:1px solid var(--border);
  border-radius:6px;
  font-family:'Cairo';
  font-weight:bold;
  text-align:center;
}

.spec-badge{
  background:#eff6ff;
  color:#1e40af;
  padding:2px 8px;
  border-radius:4px;
  font-size:.75rem;
  font-weight:600;
  display:block;
  margin-top:3px;
}

.btn-print{
  background:#000;
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.btn-update{
  background:var(--success);
  color:#fff;
  border:none;
  padding:5px 10px;
  border-radius:4px;
  cursor:pointer;
}

.link-btn{
  color:var(--primary);
  text-decoration:none;
  font-weight:bold;
  font-size:.8rem;
  border:1px solid var(--primary);
  padding:4px 8px;
  border-radius:4px;
}

/* ===== MOBILE ===== */
@media(max-width:768px){

  body{padding:10px;}

  header h1{font-size:1.2rem;}

  .stats-grid{grid-template-columns:1fr;}

  .filters{flex-direction:column;gap:8px;}

  .filters input,
  .filters select,
  .btn-search,
  .btn-group-action,
  .btn-print-all{
    width:100%;
    font-size:.9rem;
  }

  table,thead,tbody,th,td,tr{display:block;}
  thead{display:none;}

  tr{
    background:#fff;
    margin-bottom:12px;
    border-radius:10px;
    padding:10px;
    box-shadow:0 2px 6px rgba(0,0,0,0.05);
  }

  td{
    padding:6px 0;
    border:none;
    font-size:.85rem;
  }

  td::before{
    content:attr(data-label);
    font-weight:bold;
    display:block;
    color:#64748b;
    margin-bottom:2px;
  }

  .price-input{width:100%;}
  select{width:100%;}
  .btn-update,.btn-print{width:100%;margin-top:5px;}
  .link-btn{display:block;width:100%;text-align:center;}
}
</style>
</head>

<body style="display:none;">

<script>
const password = prompt("Enter Password:");
if(password==="945992"){
  document.body.style.display="block";
}else{
  document.body.innerHTML="<h2 style='text-align:center;margin-top:50px;'>Access Denied âŒ</h2>";
}
</script>

<div class="container">

<header>
<h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… TRY SHOPPY</h1>
</header>

<div class="stats-grid">
<div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (EGP)</h3><div id="totalEGP" class="value">0</div></div>
<div class="stat-card" style="border-right-color:var(--success)"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© (USD)</h3><div id="totalUSD" class="value">0</div></div>
<div class="stat-card" style="border-right-color:#f59e0b"><h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø­Ù†Ø§Øª</h3><div id="totalCount" class="value">0</div></div>
</div>

<div class="filters">
<input type="date" id="dateFrom">
<input type="date" id="dateTo">
<input id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨...">

<select id="searchStatus">
<option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
<option value="Pending Review">Pending Review</option>
<option value="Shipped To You">Shipped To You</option>
<option value="Delivered">Delivered</option>
<option value="Confirmed Via Try">Confirmed Via Try</option>
<option value="Placed">Placed</option>
<option value="Canceled">Canceled</option>
<option value="Processing">Processing</option>
<option value="Arrived USA HUB">Arrived USA HUB</option>
<option value="Arrived Cairo HUB">Arrived Cairo HUB</option>
</select>

<button class="btn-search" onclick="applyFilters()">Ø¨Ø­Ø«</button>
<button id="groupBtn" class="btn-group-action" onclick="toggleGrouping()">ğŸ”„ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
<button class="btn-print-all" onclick="printAllDisplayed()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ÙƒØ§ÙØ© Ø¨ÙˆØ§Ù„Øµ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr>
<th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
<th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</th>
<th>EGP</th>
<th>USD</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>ØªØ¹Ø¯ÙŠÙ„</th>
<th>Ø¨ÙˆÙ„ÙŠØµØ©</th>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

</div>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycbyzDnWhqG4elYJcIsgPPUlVJoA4VjG2aysQoFs0n00kOUaxwkt1GCPBkAGW19_GOwox-A/exec";
let ordersData=[],currentFilteredData=[],isGrouped=false;

async function loadData(){
  const res=await fetch(scriptURL);
  ordersData=await res.json();
  applyFilters();
}

function renderTable(data){
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";
  data.forEach(o=>{
    const cur=o.status||"Pending Review";
    const printPhone=o.phone?o.phone.toString().replace(/\s/g,''):'';
    const printOrder=o.order?o.order.toString().split(' + ')[0]:'N/A';
    const dimensionsValue=isGrouped?"Ù…ØªØ¹Ø¯Ø¯Ø©":(o.dimensions||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");

    tbody.innerHTML+=`
<tr>
<td data-label="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨"><b>${o.order}</b></td>
<td data-label="Ø§Ù„Ø¹Ù…ÙŠÙ„"><b>${o.customerName}</b><br><small>${o.phone}</small></td>
<td data-label="Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª">
<span class="spec-badge">Ø§Ù„ÙƒÙ…ÙŠØ©: ${isGrouped?o.totalQty:(o.quantity||1)}</span>
<span class="spec-badge">Ø§Ù„ÙˆØ²Ù†: ${parseFloat(o.totalWeight||o.weight||0).toFixed(2)} Ø¬Ù…</span>
<span class="spec-badge">Ø§Ù„ÙˆØµÙ: ${dimensionsValue}</span>
</td>
<td data-label="EGP"><input type="number" id="egp-${printOrder}" class="price-input" value="${o.finalPrice||0}"></td>
<td data-label="USD"><input type="number" id="usd-${printOrder}" class="price-input" value="${parseFloat(o.usd||0).toFixed(2)}"></td>
<td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">
<select id="status-${printOrder}">
<option value="Pending Review" ${cur==='Pending Review'?'selected':''}>Pending Review</option>
<option value="Confirmed Via Try" ${cur==='Confirmed Via Try'?'selected':''}>Confirmed Via Try</option>
<option value="Placed" ${cur==='Placed'?'selected':''}>Placed</option>
<option value="Processing" ${cur==='Processing'?'selected':''}>Processing</option>
<option value="Shipped To You" ${cur==='Shipped To You'?'selected':''}>Shipped To You</option>
<option value="Delivered" ${cur==='Delivered'?'selected':''}>Delivered</option>
<option value="Canceled" ${cur==='Canceled'?'selected':''}>Canceled</option>
<option value="Arrived USA HUB" ${cur==='Arrived USA HUB'?'selected':''}>Arrived USA HUB</option>
<option value="Arrived Cairo HUB" ${cur==='Arrived Cairo HUB'?'selected':''}>Arrived Cairo HUB</option>
</select>
</td>
<td data-label="ØªØ¹Ø¯ÙŠÙ„"><button class="btn-update" onclick="updateOrder('${printOrder}')">âœ”</button></td>
<td data-label="Ø¨ÙˆÙ„ÙŠØµØ©"><button class="btn-print" onclick="printLabel('${printPhone}','${printOrder}')">ğŸ“„</button></td>
<td data-label="Ø§Ù„Ù…Ù†ØªØ¬">${o.link?`<a href="${o.link}" target="_blank" class="link-btn">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</a>`:'-'}</td>
</tr>`;
  });
}

function applyFilters(){
  const search=document.getElementById("searchInput").value.toLowerCase();
  let filtered=ordersData.filter(o=>
    (o.customerName||"").toLowerCase().includes(search)||
    (o.phone||"").toString().includes(search)||
    (o.order||"").toString().includes(search)
  );

  document.getElementById("totalCount").innerText=filtered.length;
  renderTable(filtered);
  currentFilteredData=filtered;
}

function toggleGrouping(){
  isGrouped=!isGrouped;
  document.getElementById("groupBtn").classList.toggle("active");
  applyFilters();
}

function updateOrder(orderId){
  fetch(scriptURL,{
    method:"POST",
    mode:"no-cors",
    body:JSON.stringify({
      action:"updateStatus",
      order:orderId,
      status:document.getElementById(`status-${orderId}`).value,
      finalPrice:document.getElementById(`egp-${orderId}`).value,
      usd:document.getElementById(`usd-${orderId}`).value
    })
  }).then(()=>alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­"));
}

function printLabel(phone,orderId){ alert("Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø´ØºØ§Ù„Ø© Ø²ÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©"); }

function printAllDisplayed(){ alert("Ø·Ø¨Ø§Ø¹Ø© ÙƒÙ„ Ø§Ù„Ø¨ÙˆØ§Ù„Øµ"); }

loadData();
</script>

</body>
</html>
